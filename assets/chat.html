<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat</title>
  <link rel="stylesheet" href="katex/katex.min.css">
  <style>
    html, body { margin:0; padding:0; font-family:Segoe UI, Roboto, sans-serif; background:#f7f7f7; }
    #chat { padding:12px; }
    .msg { max-width:70%; margin:6px 12px; padding:10px 14px; border-radius:12px; line-height:1.45; }
    .msg.user { background:#4285F4; color:#fff; margin-left:auto; border-bottom-right-radius:4px; }
    .msg.bot  { background:#eaeaea; color:#111; margin-right:auto; border-bottom-left-radius:4px; }
    .katex-display { margin:8px 0; }
    .katex { font-size:1.05em; }
  </style>

  <!-- Load KaTeX and auto-render with defer (keeps order, loads before DOMContentLoaded) -->
  <script defer src="katex/katex.min.js"></script>
  <script defer src="katex/auto-render.min.js"></script>
</head>
<body>
  <div id="chat"></div>

  <script>
    function safeRender(el) {
      if (window.renderMathInElement) {
        renderMathInElement(el, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\[", right: "\\]", display: true},   // ← bloque estilo LaTeX
            {left: "\\(", right: "\\)", display: false}   // ← inline estilo LaTeX
          ],
          throwOnError: false
        });
      } else {
        console.warn("KaTeX auto-render not found. Check assets/katex/auto-render.min.js path.");
      }
    }

    function addMessage(role, text) {
      const el = document.createElement('div');
      el.className = 'msg ' + role;
      el.innerHTML = text.replace(/\n/g, '<br>');  // allow line breaks
      document.getElementById('chat').appendChild(el);
      safeRender(el);                               // render math if available
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // Expose to Qt
    window.addMessage = addMessage;
  </script>
</body>
</html>
